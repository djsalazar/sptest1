{% extends 'base.html' %}
{% block content %}
<div class="feedback-container">
    <!-- Header Section -->
    <div class="feedback-header">
        <div class="header-content">
            <div class="completion-badge">
                <span class="badge-icon">üéì</span>
                <span class="badge-text">Examen Completado</span>
            </div>
            <h2>Resultados - NFTs y Propiedad Intelectual</h2>
            <div class="student-info">
                <div class="info-item">
                    <span class="info-label">üë§ Participante:</span>
                    <span class="info-value">{{ student_name }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">üÜî Identificaci√≥n:</span>
                    <span class="info-value">{{ student_carne }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">üìÖ Fecha:</span>
                    <span class="info-value" id="completion-date"></span>
                </div>
            </div>
        </div>
        
        <div class="score-summary">
            <div class="total-score">
                <div class="score-circle {{ 'score-high' if total_score >= 80 else 'score-medium' if total_score >= 60 else 'score-low' }}">
                    <div class="score-value">{{ '%.0f'|format(total_score) }}</div>
                    <div class="score-label">/ 100</div>
                </div>
                <div class="score-description">
                    {% if total_score >= 90 %}
                    <span class="grade-label excellent">Excelente</span>
                    <span class="grade-description">Dominio excepcional de NFTs y PI</span>
                    {% elif total_score >= 80 %}
                    <span class="grade-label good">Muy Bueno</span>
                    <span class="grade-description">S√≥lido conocimiento jur√≠dico</span>
                    {% elif total_score >= 70 %}
                    <span class="grade-label satisfactory">Bueno</span>
                    <span class="grade-description">Comprensi√≥n adecuada</span>
                    {% elif total_score >= 60 %}
                    <span class="grade-label acceptable">Aceptable</span>
                    <span class="grade-description">Conocimientos b√°sicos</span>
                    {% else %}
                    <span class="grade-label needs-improvement">Necesita Mejorar</span>
                    <span class="grade-description">Revisar conceptos fundamentales</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Overview -->
    <div class="performance-overview">
        <h3>üìä Resumen de Rendimiento</h3>
        <div class="performance-grid">
            <div class="performance-item">
                <div class="performance-icon">‚öñÔ∏è</div>
                <div class="performance-content">
                    <div class="performance-value">{{ ((all_cases_data | selectattr('answers') | map(attribute='answers') | list | flatten | selectattr('user_bool', 'equalto', all_cases_data | selectattr('answers') | map(attribute='answers') | list | flatten | map(attribute='correct_bool') | list) | list | length) / 10 * 100) | round(1) }}%</div>
                    <div class="performance-label">Precisi√≥n V/F</div>
                    <div class="performance-description">Respuestas correctas</div>
                </div>
            </div>
            <div class="performance-item">
                <div class="performance-icon">‚úçÔ∏è</div>
                <div class="performance-content">
                    <div class="performance-value">{{ (all_cases_data | selectattr('answers') | map(attribute='answers') | list | flatten | selectattr('breakdown.argument', 'gt', 3) | list | length) }}/10</div>
                    <div class="performance-label">Justificaciones S√≥lidas</div>
                    <div class="performance-description">Con an√°lisis jur√≠dico profundo</div>
                </div>
            </div>
            <div class="performance-item">
                <div class="performance-icon">üîó</div>
                <div class="performance-content">
                    <div class="performance-value">{{ (all_cases_data | selectattr('answers') | map(attribute='answers') | list | flatten | selectattr('breakdown.ai_analysis.comprension_nft', 'defined') | selectattr('breakdown.ai_analysis.comprension_nft', 'gt', 3) | list | length) }}/10</div>
                    <div class="performance-label">Comprensi√≥n NFT</div>
                    <div class="performance-description">Conceptos bien aplicados</div>
                </div>
            </div>
            <div class="performance-item">
                <div class="performance-icon">ü§ñ</div>
                <div class="performance-content">
                    <div class="performance-value">{{ '%.1f'|format((all_cases_data | selectattr('answers') | map(attribute='answers') | list | flatten | selectattr('breakdown.ai_analysis.score', 'defined') | map(attribute='breakdown.ai_analysis.score') | list | sum) / (all_cases_data | selectattr('answers') | map(attribute='answers') | list | flatten | selectattr('breakdown.ai_analysis.score', 'defined') | list | length)) if (all_cases_data | selectattr('answers') | map(attribute='answers') | list | flatten | selectattr('breakdown.ai_analysis.score', 'defined') | list | length) > 0 else 0 }}/5</div>
                    <div class="performance-label">Evaluaci√≥n IA</div>
                    <div class="performance-description">An√°lisis automatizado</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Warning Alert for Low Scores -->
    {% if paste_penalty > 0 or total_score < 60 %}
    <div class="warning-alert">
        <div class="alert-icon">‚ö†Ô∏è</div>
        <div class="alert-content">
            <h4>Observaciones Importantes</h4>
            {% if paste_penalty > 0 %}
            <p><strong>Penalizaci√≥n por Copy-Paste:</strong> Se detect√≥ uso excesivo de copy-paste (-{{ paste_penalty }} puntos). Para futuros ex√°menes, redacte con sus propias palabras.</p>
            {% endif %}
            {% if total_score < 60 %}
            <p><strong>Recomendaci√≥n:</strong> Se sugiere revisar el documento de referencia sobre NFTs y profundizar en los conceptos de separaci√≥n obra-soporte, smart contracts y marco legal guatemalteco.</p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Detailed Results by Case -->
    {% for case_data in all_cases_data %}
    <div class="case-results">
        <div class="case-results-header">
            <div class="case-title-section">
                <div class="case-number">{{ case_data.case.case_id }}</div>
                <div class="case-title-content">
                    <h3>{{ case_data.case.title }}</h3>
                    <div class="case-tags">
                        <span class="nft-tag">üîó NFT</span>
                        <span class="pi-tag">‚öñÔ∏è PI</span>
                    </div>
                </div>
            </div>
            <div class="case-score-summary">
                <div class="case-score {{ 'score-high' if case_data.score >= 16 else 'score-medium' if case_data.score >= 12 else 'score-low' }}">
                    {{ '%.0f'|format(case_data.score) }}/20
                </div>
                <div class="case-performance">
                    {{ '%.0f'|format((case_data.score / 20) * 100) }}%
                </div>
            </div>
        </div>

        <div class="case-description">
            <p>{{ case_data.case.description }}</p>
        </div>

        <!-- Questions Results -->
        {% for answer in case_data.answers %}
        <div class="question-result">
            <div class="question-result-header">
                <h4>Pregunta {{ loop.index }}</h4>
                <div class="question-score {{ 'score-high' if answer.score >= 8 else 'score-medium' if answer.score >= 6 else 'score-low' }}">
                    {{ '%.1f'|format(answer.score) }}/10
                </div>
            </div>

            <!-- Question Text -->
            <div class="question-content">
                <div class="question-statement">
                    <strong>Afirmaci√≥n:</strong> {{ answer.question_text }}
                </div>
            </div>

            <!-- Answer Comparison -->
            <div class="answer-comparison">
                <div class="student-response">
                    <div class="response-header">
                        <span class="response-icon">üë§</span>
                        <span class="response-label">Su Respuesta:</span>
                    </div>
                    <div class="response-value {{ 'correct' if answer.user_bool == answer.correct_bool else 'incorrect' }}">
                        {{ 'Verdadero' if answer.user_bool else 'Falso' }}
                        {% if answer.user_bool == answer.correct_bool %}
                        <span class="result-indicator">‚úÖ</span>
                        {% else %}
                        <span class="result-indicator">‚ùå</span>
                        {% endif %}
                    </div>
                </div>
                <div class="correct-response">
                    <div class="response-header">
                        <span class="response-icon">‚úÖ</span>
                        <span class="response-label">Respuesta Correcta:</span>
                    </div>
                    <div class="response-value correct">
                        {{ 'Verdadero' if answer.correct_bool else 'Falso' }}
                    </div>
                </div>
            </div>

            <!-- Score Breakdown -->
            <div class="score-breakdown">
                <h5>üìä Desglose de Puntuaci√≥n</h5>
                <div class="breakdown-grid">
                    <div class="breakdown-item {{ 'correct' if answer.user_bool == answer.correct_bool else 'incorrect' }}">
                        <span class="breakdown-label">Veracidad:</span>
                        <span class="breakdown-score">{{ '%.1f'|format(answer.breakdown.truth) }}/5</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Argumentaci√≥n:</span>
                        <span class="breakdown-score">{{ '%.1f'|format(answer.breakdown.argument) }}/5</span>
                    </div>
                    {% if answer.breakdown.ai_penalty < 0 %}
                    <div class="breakdown-item penalty">
                        <span class="breakdown-label">Penalizaciones:</span>
                        <span class="breakdown-score">{{ '%.1f'|format(answer.breakdown.ai_penalty) }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Student Justification -->
            <div class="justification-section">
                <h5>‚úçÔ∏è Su Justificaci√≥n</h5>
                <div class="justification-content">
                    {{ answer.user_reason }}
                </div>
                <div class="justification-stats">
                    <span class="stat-item">üìè {{ answer.user_reason|length }} caracteres</span>
                    <span class="stat-item">üìù {{ answer.user_reason.split()|length }} palabras</span>
                </div>
            </div>

            <!-- AI Analysis (if available) -->
            {% if answer.breakdown.ai_analysis and answer.breakdown.ai_analysis.comprension_nft %}
            <div class="ai-analysis-section">
                <h5>ü§ñ An√°lisis con IA Especializada</h5>
                <div class="ai-criteria-grid">
                    <div class="criterion-item">
                        <span class="criterion-label">üîó Comprensi√≥n NFT:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.comprension_nft }}">
                            {{ answer.breakdown.ai_analysis.comprension_nft }}/5
                        </span>
                    </div>
                    <div class="criterion-item">
                        <span class="criterion-label">‚öñÔ∏è Aplicaci√≥n Normativa:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.aplicacion_normativa }}">
                            {{ answer.breakdown.ai_analysis.aplicacion_normativa }}/5
                        </span>
                    </div>
                    <div class="criterion-item">
                        <span class="criterion-label">üì± Distinci√≥n Soporte:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.distincion_soporte }}">
                            {{ answer.breakdown.ai_analysis.distincion_soporte }}/5
                        </span>
                    </div>
                    <div class="criterion-item">
                        <span class="criterion-label">üìÑ Smart Contracts:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.smart_contracts }}">
                            {{ answer.breakdown.ai_analysis.smart_contracts }}/5
                        </span>
                    </div>
                    <div class="criterion-item">
                        <span class="criterion-label">üíº Derechos Patrimoniales:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.derechos_patrimoniales }}">
                            {{ answer.breakdown.ai_analysis.derechos_patrimoniales }}/5
                        </span>
                    </div>
                    <div class="criterion-item">
                        <span class="criterion-label">üèõÔ∏è Marco Constitucional:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.marco_constitucional }}">
                            {{ answer.breakdown.ai_analysis.marco_constitucional }}/5
                        </span>
                    </div>
                    <div class="criterion-item">
                        <span class="criterion-label">üß† Coherencia:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.coherencia }}">
                            {{ answer.breakdown.ai_analysis.coherencia }}/5
                        </span>
                    </div>
                    <div class="criterion-item">
                        <span class="criterion-label">üìö Jurisprudencia:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.jurisprudencia }}">
                            {{ answer.breakdown.ai_analysis.jurisprudencia }}/5
                        </span>
                    </div>
                    <div class="criterion-item">
                        <span class="criterion-label">üí° Aplicaci√≥n Pr√°ctica:</span>
                        <span class="criterion-score score-{{ answer.breakdown.ai_analysis.aplicacion_practica }}">
                            {{ answer.breakdown.ai_analysis.aplicacion_practica }}/5
                        </span>
                    </div>
                </div>
                
                {% if answer.breakdown.feedback %}
                <div class="ai-feedback">
                    <h6>üí¨ Retroalimentaci√≥n Especializada:</h6>
                    <div class="feedback-content">
                        {{ answer.breakdown.feedback }}
                    </div>
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="ai-unavailable">
                <div class="unavailable-icon">üîß</div>
                <div class="unavailable-text">
                    <p><strong>An√°lisis IA no disponible</strong></p>
                    <p>El an√°lisis detallado con inteligencia artificial no pudo completarse para esta respuesta.</p>
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endfor %}

    <!-- Recommendations Section -->
    <div class="recommendations-section">
        <h3>üéØ Recomendaciones Personalizadas</h3>
        <div class="recommendations-grid">
            {% if total_score >= 80 %}
            <div class="recommendation-item excellent">
                <div class="recommendation-icon">üåü</div>
                <div class="recommendation-content">
                    <h4>¬°Excelente Desempe√±o!</h4>
                    <p>Demuestra un s√≥lido dominio de los conceptos sobre NFTs y propiedad intelectual. Considere profundizar en temas avanzados como aspectos fiscales de NFTs o contratos inteligentes complejos.</p>
                </div>
            </div>
            {% elif total_score >= 60 %}
            <div class="recommendation-item good">
                <div class="recommendation-icon">üìà</div>
                <div class="recommendation-content">
                    <h4>Buen Fundamento</h4>
                    <p>Muestra comprensi√≥n b√°sica s√≥lida. Recomendamos revisar casos espec√≠ficos de separaci√≥n obra-soporte y profundizar en la aplicaci√≥n pr√°ctica de smart contracts en el derecho guatemalteco.</p>
                </div>
            </div>
            {% else %}
            <div class="recommendation-item needs-work">
                <div class="recommendation-icon">üìö</div>
                <div class="recommendation-content">
                    <h4>Oportunidades de Mejora</h4>
                    <p>Se recomienda una revisi√≥n integral del documento de referencia, especialmente los conceptos fundamentales sobre la naturaleza jur√≠dica de los NFTs y su diferenciaci√≥n con las obras intelectuales.</p>
                </div>
            </div>
            {% endif %}

            <div class="recommendation-item resources">
                <div class="recommendation-icon">üìñ</div>
                <div class="recommendation-content">
                    <h4>Recursos Adicionales</h4>
                    <ul>
                        <li>Revisar jurisprudencia internacional sobre NFTs</li>
                        <li>Estudiar casos pr√°cticos de smart contracts</li>
                        <li>Analizar legislaci√≥n comparada en PI digital</li>
                        <li>Profundizar en aspectos constitucionales</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="{{ url_for('index') }}" class="btn btn-primary">
            üîÑ Tomar Nuevo Examen
        </a>
        <button onclick="window.print()" class="btn btn-secondary">
            üñ®Ô∏è Imprimir Resultados
        </button>
        <button onclick="exportToPDF()" class="btn btn-secondary">
            üìÑ Exportar PDF
        </button>
    </div>
</div>

<style>
.feedback-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

/* Header Section */
.feedback-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow);
}

.completion-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(255,255,255,0.2);
    padding: 0.75rem 1.5rem;
    border-radius: 25px;
    margin-bottom: 1rem;
    font-weight: 600;
}

.badge-icon {
    font-size: 1.3rem;
}

.feedback-header h2 {
    margin: 0 0 1rem 0;
    color: var(--white);
    font-size: 1.8rem;
}

.student-info {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.info-item {
    display: flex;
    gap: 1rem;
}

.info-label {
    font-size: 0.9rem;
    opacity: 0.8;
    min-width: 120px;
}

.info-value {
    font-weight: 600;
}

/* Score Summary */
.score-summary {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.total-score {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.score-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    border: 4px solid rgba(255,255,255,0.3);
    position: relative;
    overflow: hidden;
}

.score-circle::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    opacity: 0.2;
}

.score-high { background-color: #27ae60; }
.score-high::before { background-color: #2ecc71; }

.score-medium { background-color: #f39c12; color: #000; }
.score-medium::before { background-color: #e67e22; }

.score-low { background-color: #e74c3c; }
.score-low::before { background-color: #c0392b; }

.score-value {
    font-size: 2.5rem;
    z-index: 1;
    position: relative;
}

.score-label {
    font-size: 1rem;
    z-index: 1;
    position: relative;
    opacity: 0.9;
}

.score-description {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
}

.grade-label {
    font-size: 1.2rem;
    font-weight: 700;
    padding: 0.5rem 1rem;
    border-radius: 20px;
}

.grade-label.excellent { background: rgba(39, 174, 96, 0.2); color: #27ae60; }
.grade-label.good { background: rgba(52, 152, 219, 0.2); color: #3498db; }
.grade-label.satisfactory { background: rgba(243, 156, 18, 0.2); color: #f39c12; }
.grade-label.acceptable { background: rgba(255, 152, 0, 0.2); color: #ff9800; }
.grade-label.needs-improvement { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }

.grade-description {
    font-size: 0.9rem;
    opacity: 0.9;
}

/* Performance Overview */
.performance-overview {
    background: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
    border: 1px solid #e1e8ed;
}

.performance-overview h3 {
    margin: 0 0 1.5rem 0;
    color: var(--primary-color);
    text-align: center;
}

.performance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.performance-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: var(--border-radius);
    border-left: 4px solid var(--secondary-color);
}

.performance-icon {
    font-size: 2.5rem;
    opacity: 0.8;
}

.performance-content {
    flex: 1;
}

.performance-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
}

.performance-label {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
}

.performance-description {
    font-size: 0.85rem;
    color: var(--dark-gray);
}

/* Warning Alert */
.warning-alert {
    background: rgba(231, 76, 60, 0.1);
    border: 2px solid #e74c3c;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    margin-bottom: 2rem;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.alert-icon {
    font-size: 2rem;
    color: #e74c3c;
    flex-shrink: 0;
}

.alert-content h4 {
    margin: 0 0 1rem 0;
    color: #c0392b;
}

.alert-content p {
    margin: 0 0 0.5rem 0;
    color: #721c24;
    line-height: 1.6;
}

/* Case Results */
.case-results {
    background: var(--white);
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
    border: 1px solid #e1e8ed;
    overflow: hidden;
}

.case-results-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 1.5rem;
    border-bottom: 1px solid #e1e8ed;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.case-title-section {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.case-number {
    background: var(--secondary-color);
    color: var(--white);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
}

.case-title-content h3 {
    margin: 0 0 0.5rem 0;
    color: var(--primary-color);
    font-size: 1.2rem;
}

.case-tags {
    display: flex;
    gap: 0.5rem;
}

.nft-tag, .pi-tag {
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 500;
}

.nft-tag { background: rgba(156, 39, 176, 0.1); color: #9c27b0; }
.pi-tag { background: rgba(52, 152, 219, 0.1); color: #3498db; }

.case-score-summary {
    text-align: center;
}

.case-score {
    font-size: 1.5rem;
    font-weight: 700;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    color: var(--white);
    margin-bottom: 0.25rem;
}

.case-performance {
    font-size: 0.9rem;
    color: var(--dark-gray);
    font-weight: 500;
}

.case-description {
    padding: 1.5rem;
    background: #f8f9fa;
    border-bottom: 1px solid #e1e8ed;
    color: #495057;
    line-height: 1.6;
}

/* Question Results */
.question-result {
    padding: 2rem;
    border-bottom: 1px solid #e1e8ed;
}

.question-result:last-child {
    border-bottom: none;
}

.question-result-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #f0f0f0;
}

.question-result-header h4 {
    margin: 0;
    color: var(--primary-color);
    font-size: 1.1rem;
}

.question-score {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    color: var(--white);
    font-weight: 700;
    font-size: 1.1rem;
}

.question-content {
    margin-bottom: 1.5rem;
}

.question-statement {
    background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%);
    border-left: 4px solid var(--secondary-color);
    padding: 1.5rem;
    border-radius: 0 var(--border-radius) var(--border-radius) 0;
    color: var(--primary-color);
    line-height: 1.6;
}

/* Answer Comparison */
.answer-comparison {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.student-response, .correct-response {
    padding: 1rem;
    border-radius: var(--border-radius);
    border: 2px solid;
}

.student-response {
    border-color: #e1e8ed;
    background: #f8f9fa;
}

.correct-response {
    border-color: var(--success-color);
    background: rgba(39, 174, 96, 0.05);
}

.response-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    font-weight: 600;
    color: var(--primary-color);
}

.response-icon {
    font-size: 1.1rem;
}

.response-value {
    font-size: 1.2rem;
    font-weight: 700;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.response-value.correct {
    background: var(--success-color);
    color: var(--white);
}

.response-value.incorrect {
    background: var(--accent-color);
    color: var(--white);
}

.result-indicator {
    font-size: 1.1rem;
}

/* Score Breakdown */
.score-breakdown {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: var(--border-radius);
    margin-bottom: 1.5rem;
}

.score-breakdown h5 {
    margin: 0 0 1rem 0;
    color: var(--primary-color);
}

.breakdown-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.breakdown-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: var(--white);
    border-radius: var(--border-radius);
    border: 2px solid #e1e8ed;
}

.breakdown-item.correct {
    border-color: var(--success-color);
    background: rgba(39, 174, 96, 0.05);
}

.breakdown-item.incorrect {
    border-color: var(--accent-color);
    background: rgba(231, 76, 60, 0.05);
}

.breakdown-item.penalty {
    border-color: var(--warning-color);
    background: rgba(243, 156, 18, 0.05);
}

.breakdown-label {
    font-weight: 500;
    color: var(--primary-color);
}

.breakdown-score {
    font-weight: 700;
    color: var(--primary-color);
}

/* Justification Section */
.justification-section {
    margin-bottom: 1.5rem;
}

.justification-section h5 {
    margin: 0 0 1rem 0;
    color: var(--primary-color);
}

.justification-content {
    background: var(--white);
    border: 2px solid #e1e8ed;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    line-height: 1.6;
    color: #495057;
    margin-bottom: 1rem;
}

.justification-stats {
    display: flex;
    gap: 2rem;
    font-size: 0.9rem;
    color: var(--dark-gray);
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* AI Analysis Section */
.ai-analysis-section {
    background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
    border-left: 5px solid #9c27b0;
    padding: 1.5rem;
    border-radius: 0 var(--border-radius) var(--border-radius) 0;
    margin-bottom: 1rem;
}

.ai-analysis-section h5 {
    margin: 0 0 1rem 0;
    color: #7b1fa2;
}

.ai-criteria-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.criterion-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: rgba(255,255,255,0.7);
    border-radius: var(--border-radius);
}

.criterion-label {
    font-weight: 500;
    color: var(--primary-color);
    font-size: 0.9rem;
}

.criterion-score {
    font-weight: 700;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    color: var(--white);
    font-size: 0.85rem;
}

.criterion-score.score-5 { background: #27ae60; }
.criterion-score.score-4 { background: #3498db; }
.criterion-score.score-3 { background: #f39c12; color: #000; }
.criterion-score.score-2 { background: #e67e22; }
.criterion-score.score-1 { background: #e74c3c; }

/* AI Feedback */
.ai-feedback {
    background: rgba(255,255,255,0.8);
    border-radius: var(--border-radius);
    padding: 1rem;
}

.ai-feedback h6 {
    margin: 0 0 0.75rem 0;
    color: #7b1fa2;
}

.feedback-content {
    color: #4a148c;
    line-height: 1.6;
    font-style: italic;
}

/* AI Unavailable */
.ai-unavailable {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: rgba(108, 117, 125, 0.1);
    border: 2px dashed #6c757d;
    border-radius: var(--border-radius);
    margin-bottom: 1rem;
}

.unavailable-icon {
    font-size: 2rem;
    opacity: 0.6;
}

.unavailable-text p {
    margin: 0;
    color: var(--dark-gray);
}

.unavailable-text p:first-child {
    font-weight: 600;
    color: var(--primary-color);
}

/* Recommendations */
.recommendations-section {
    background: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
    border: 1px solid #e1e8ed;
}

.recommendations-section h3 {
    margin: 0 0 1.5rem 0;
    color: var(--primary-color);
    text-align: center;
}

.recommendations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.recommendation-item {
    padding: 1.5rem;
    border-radius: var(--border-radius);
    border-left: 5px solid;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.recommendation-item.excellent {
    background: rgba(39, 174, 96, 0.05);
    border-left-color: var(--success-color);
}

.recommendation-item.good {
    background: rgba(52, 152, 219, 0.05);
    border-left-color: var(--secondary-color);
}

.recommendation-item.needs-work {
    background: rgba(231, 76, 60, 0.05);
    border-left-color: var(--accent-color);
}

.recommendation-item.resources {
    background: rgba(243, 156, 18, 0.05);
    border-left-color: var(--warning-color);
}

.recommendation-icon {
    font-size: 2rem;
    flex-shrink: 0;
    margin-top: 0.25rem;
}

.recommendation-content h4 {
    margin: 0 0 0.75rem 0;
    color: var(--primary-color);
}

.recommendation-content p {
    margin: 0;
    line-height: 1.6;
    color: #495057;
}

.recommendation-content ul {
    margin: 0.5rem 0 0 0;
    padding-left: 1.5rem;
}

.recommendation-content li {
    margin-bottom: 0.25rem;
    color: #495057;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 2rem;
}

.action-buttons .btn {
    padding: 1rem 2rem;
    border-radius: 25px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .feedback-container {
        padding: 1rem;
    }
    
    .feedback-header {
        flex-direction: column;
        gap: 1.5rem;
        text-align: center;
    }
    
    .performance-grid {
        grid-template-columns: 1fr;
    }
    
    .case-results-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .answer-comparison {
        grid-template-columns: 1fr;
    }
    
    .breakdown-grid {
        grid-template-columns: 1fr;
    }
    
    .ai-criteria-grid {
        grid-template-columns: 1fr;
    }
    
    .recommendations-grid {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .action-buttons .btn {
        width: 100%;
        max-width: 300px;
    }
}

/* Print Styles */
@media print {
    .action-buttons {
        display: none;
    }
    
    .feedback-container {
        box-shadow: none;
    }
    
    .case-results,
    .performance-overview,
    .recommendations-section {
        box-shadow: none;
        border: 1px solid #ccc;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set completion date
    document.getElementById('completion-date').textContent = new Date().toLocaleDateString('es-GT');
    
    // Add scroll animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observe sections
    document.querySelectorAll('.case-results, .performance-overview, .recommendations-section').forEach(section => {
        section.style.opacity = '0';
        section.style.transform = 'translateY(20px)';
        section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(section);
    });
});

function exportToPDF() {
    // Simple PDF export using browser's print functionality
    const originalTitle = document.title;
    document.title = `Resultados_NFT_{{ student_name.replace(" ", "_") }}_{{ student_carne }}`;
    
    window.print();
    
    setTimeout(() => {
        document.title = originalTitle;
    }, 1000);
}
</script>
{% endblock %}