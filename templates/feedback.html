{% extends 'base.html' %}
{% block content %}
<section class="feedback-container">
    <h2>Resultados de la Evaluación</h2>
    <p>Calificación total: <strong>{{ '%.2f'|format(total_score) }}</strong> / 100</p>
    {% if paste_penalty > 0 %}
    <p class="warning">Se aplicó una penalización por {{ paste_penalty|int }} puntos debido a eventos de pegado detectados.</p>
    {% endif %}
    <ol>
    {% for answer in answers %}
        <li>
            <p><strong>Pregunta {{ loop.index }}:</strong> {{ case.questions[loop.index0].text }}</p>
            <p>Su respuesta: <em>{{ 'Verdadero' if answer.user_bool else 'Falso' }}</em></p>
            <p>Respuesta correcta: <em>{{ 'Verdadero' if case.questions[loop.index0].correct else 'Falso' }}</em></p>
            <p>Justificación proporcionada:</p>
            <blockquote>{{ answer.user_reason }}</blockquote>
            <p>Puntuación: {{ '%.2f'|format(answer.score) }} / 100</p>
            
            <!-- Breakdown básico -->
            <ul class="breakdown">
                <li>Veracidad: {{ '%.1f'|format(answer.breakdown.truth) }} pts</li>
                <li>Argumentación: {{ '%.1f'|format(answer.breakdown.argument) }} pts</li>
                {% if answer.breakdown.ai_penalty < 0 %}
                <li>Penalización por IA: {{ '%.1f'|format(answer.breakdown.ai_penalty) }} pts</li>
                {% endif %}
            </ul>
            
            <!-- Análisis detallado de IA si está disponible -->
            {% if answer.breakdown.ai_analysis %}
            <div class="ai-analysis">
                <h4>Análisis Detallado de Argumentación</h4>
                <div class="criteria-scores">
                    <div class="criteria-grid">
                        <div class="criterion">
                            <span class="criterion-name">Opinión fundada:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.opinion_fundada }}/5</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-name">Valores éticos:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.valores_eticos }}/5</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-name">Lenguaje y terminología:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.lenguaje_terminologia }}/5</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-name">Citas y precisión:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.citas_precision }}/5</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-name">Estructura y coherencia:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.estructura_coherencia }}/5</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-name">Profundidad:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.profundidad_fundamentacion }}/5</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-name">Capacidad crítica:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.capacidad_critica }}/5</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-name">Presentación:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.presentacion_estilo }}/5</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-name">Innovación:</span>
                            <span class="score">{{ answer.breakdown.ai_analysis.innovacion_creatividad }}/5</span>
                        </div>
                    </div>
                </div>
                
                {% if answer.breakdown.feedback %}
                <div class="ai-feedback">
                    <h5>Retroalimentación Específica:</h5>
                    <p>{{ answer.breakdown.feedback }}</p>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </li>
    {% endfor %}
    </ol>
    <p><a href="{{ url_for('take_test', case_id=case.case_id) }}">Volver a intentar el caso</a></p>
    <p><a href="{{ url_for('index') }}">Inicio</a></p>
</section>
{% endblock %}